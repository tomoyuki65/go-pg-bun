# Go言語からPostgreSQLを使うためのサンプル
Docker環境でGo言語（Golang）からDBにPostgreSQL、マイグレーションにAtlas、ORMにBunを使う方法についてのサンプルです。  
  
<br>
  
## 動作要件
- Go: 1.25.5
- Echo: v4.15.0
- PostgreSQL: 18.1
  
<br>
  
## ローカル開発環境構築
### 1. 環境変数ファイルをリネーム
```
cp ./.env.example ./.env
```  
  
### 2. コンテナのビルドと起動
```
docker compose build --no-cache
docker compose up -d
```  
  
### 3. コンテナの停止・削除
```
docker compose down
```  
> ※ボリュームも合わせて削除したい場合は、オプション「-v」を付けて実行して下さい。（例：docker compose down -v）  
  
<br>
  
## DBコンテナへの接続方法
### 1. DBコンテナへ接続
```
docker compose exec db bash
```  
### 2. PostgreSQLにログイン
```
PGPASSWORD=local-db-password psql -U local-db-user -d local-db-name
```  
> ※ユーザーなどは.envファイルの環境変数で設定
  
<br>
  
## サンプルSQL
・ユーザーテーブルの作成  
```
CREATE TABLE users (
  id BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR NOT NULL,
  email VARCHAR NOT NULL UNIQUE,
  created_at TIMESTAMPTZ NOT NULL,
  updated_at TIMESTAMPTZ NOT NULL
);
```
  
・ユーザーを1件作成  
```
INSERT INTO users (name, email, created_at, updated_at)
  VALUES ('田中太郎', 't.tanaka@example.com', NOW(), NOW());
```
  
・全てのユーザーを取得  
```
SELECT * FROM users;
```
  
・メールアドレスを更新  
```
UPDATE users SET email = 'taro.tanaka@example.com', updated_at = NOW() WHERE id = 1;
```
  
・対象ユーザーを削除  
```
DELETE FROM users WHERE id = 1;
```
  
<br>
  
## DBクライアントツール「pgAdmin」について
GUIで各種DB操作をしたい場合、OSSにPostgreSQL用のDBクライアントツール「pgAdmin 4」があります。  
PCがMacかつパッケージ管理に「Homebrew」を使っている場合は、以下のコマンドで簡単にインストール可能です。  
  
### 1. インストール方法
・「Homebrew」の最新化
```
brew update
```

・「pgAdmin 4」のインストール
```
brew install --cask pgadmin4
```
  
### 2. 接続設定
DBの接続設定は環境変数「.env」ファイルの内容を利用します。  
```
Host name/address: localhost
Port: 5432
Maintenance database: local-db-name
Username: local-db-user
Password: local-db-password
Save password?: Yes（有効化する）
```
  
### 3. SQLを実行したい場合
画面左のツリーから対象DB（例：go-pg-db > Database(2) > local-db-name）を右クリックしてメニューを開き、「Query Tool」をクリックするとSQL実行用の画面が開けます。  
  
SQLを記述後、画面上のメニューにある実行ボタン「▶︎」（左側のExecute scriptボタンは記述内容を全て実行するやつで、右側のExecute queryボタンは単一のSQLを実行するやつです）をクリックしてください。  
  
> ※デフォルトではオートコミット設定になっています。
  
<br>
  
## マイグレーションの実行方法
xxx  
  
<br>
  
## サンプルAPIのエンドポイント
- xxx
- xxx
- xxx
- xxx
  
  